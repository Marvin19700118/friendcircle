import{r as o,R as A,j as e,S as n}from"./index-FOHbnj39.js";import{s as L,a as O,b as H}from"./dataService-CBqyM4Ad.js";const V=({user:i,onLogout:g,currentScreen:x,onNavigate:c,logs:h=[]})=>{const[p,j]=o.useState("全部"),[m,y]=o.useState("全部"),[b,N]=o.useState(""),[f,w]=o.useState([]),[u,k]=o.useState([]);A.useEffect(()=>{if(i!=null&&i.uid){console.log("Dashboard: 訂閱使用者資料...",i.uid);const t=L(i.uid,s=>{w(s)}),r=O(i.uid,s=>{k(s)});return()=>{t(),r()}}},[i]);const v=o.useMemo(()=>{const t=["全部","廠商","客戶","家人","VIP"],r=t.map(a=>({name:a,icon:a==="全部"?"groups":"label"})),l=u.filter(a=>!t.includes(a.name)).map(a=>({name:a.name,icon:a.icon||"label"}));return[...r,...l,{name:"新增",icon:"add"}]},[u]),C=async t=>{if(t==="新增"){const r=window.prompt("請輸入新標籤名稱：");if(r&&(i!=null&&i.uid))try{await H(i.uid,{name:r,icon:"label"})}catch(s){console.error("Error adding tag:",s),alert("新增標籤失敗")}}else y(t)},S=o.useMemo(()=>{let t=f.filter(s=>{var d;const l=s.name.toLowerCase().includes(b.toLowerCase())||((d=s.company)==null?void 0:d.toLowerCase().includes(b.toLowerCase())),a=m==="全部"||s.tags&&s.tags.includes(m);return l&&a});p==="AI 推薦"?t=t.filter(s=>{var d;const l=(d=s.tags)==null?void 0:d.includes("VIP"),a=!s.interactions||s.interactions.length===0;return l||a}):p==="需要跟進"&&(t=t.filter(s=>{var l,a;return((l=s.tags)==null?void 0:l.includes("近期未聯繫"))||((a=s.tags)==null?void 0:a.includes("需要跟進"))}));const r={};return t.forEach(s=>{var d;const l=(((d=s.initials)==null?void 0:d[0])||s.name.charAt(0)).toUpperCase(),a=/^[A-Z]$/.test(l)?l:"#";r[a]||(r[a]=[]),r[a].push(s)}),Object.keys(r).sort().reduce((s,l)=>(s[l]=r[l],s),{})},[m,b,f,p]),T=()=>e.jsxs("div",{className:"flex flex-col gap-4 p-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"操作紀錄"}),e.jsxs("span",{className:"text-xs text-slate-400 font-medium",children:[h.length," 筆活動"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:h.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-slate-50 dark:border-slate-700 flex gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl shrink-0 flex items-center justify-center ${t.type==="create"?"bg-green-50 text-green-600":t.type==="update"?"bg-blue-50 text-blue-600":t.type==="photo"?"bg-amber-50 text-amber-600":"bg-purple-50 text-purple-600"}`,children:e.jsx("span",{className:"material-symbols-outlined text-[20px]",children:t.type==="create"?"person_add":t.type==="update"?"edit_note":t.type==="photo"?"image":"event_repeat"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("h4",{className:"font-bold text-slate-800 dark:text-white text-sm",children:t.action}),e.jsx("span",{className:"text-[10px] text-slate-400",children:t.timestamp})]}),e.jsxs("p",{className:"text-[11px] text-slate-500 font-medium mb-1",children:["對象：",t.contactName]}),e.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:t.details})]})]},t.id))})]}),I=()=>e.jsxs("div",{className:"flex flex-col gap-4 pt-2",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"relative flex items-center bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 px-4 py-3 shadow-sm transition-all focus-within:ring-2 focus-within:ring-primary/20",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-400 mr-2",children:"search"}),e.jsx("input",{type:"text",placeholder:"搜尋姓名、公司或職稱...",className:"flex-1 bg-transparent border-none focus:ring-0 text-sm p-0 text-slate-700 dark:text-white",value:b,onChange:t=>N(t.target.value)})]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-5",children:[e.jsx("h3",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"我的社交圈"}),e.jsx("span",{className:"material-symbols-outlined text-slate-300 text-[16px]",children:"settings"})]}),e.jsx("div",{className:"flex gap-2.5 px-4 overflow-x-auto no-scrollbar py-1",children:v.map(t=>e.jsxs("button",{onClick:()=>C(t.name),className:`flex items-center gap-1.5 flex-none px-4 py-2 rounded-full text-xs font-bold transition-all ${m===t.name?"bg-primary text-white shadow-md shadow-primary/20 scale-105":"bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-100 dark:border-slate-700 hover:border-primary/50"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-[16px]",style:{fontVariationSettings:m===t.name?"'FILL' 1":""},children:t.icon}),t.name]},t.name))})]}),e.jsx("div",{className:"flex gap-2 px-4 py-1 border-t border-slate-50 dark:border-slate-800 mt-1 pt-3",children:["全部","AI 推薦","需要跟進"].map(t=>e.jsx("button",{onClick:()=>j(t),className:`flex-none px-5 py-2 rounded-xl text-xs font-bold transition-all ${p===t?"bg-slate-900 dark:bg-white text-white dark:text-slate-900":"text-slate-400 dark:text-slate-500"}`,children:t},t))}),e.jsx("div",{className:"px-4 pb-12 min-h-[400px]",children:Object.entries(S).map(([t,r])=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-primary text-[11px] font-bold mb-3 ml-2 uppercase tracking-widest bg-blue-50 dark:bg-blue-900/20 w-7 h-7 flex items-center justify-center rounded-lg",children:t}),e.jsx("div",{className:"flex flex-col gap-3",children:r.map(s=>e.jsxs("div",{onClick:()=>c(n.CONTACT_DETAIL,s),className:"bg-white dark:bg-slate-800 rounded-3xl p-3.5 flex items-center justify-between shadow-sm border border-slate-50 dark:border-slate-700 cursor-pointer active:scale-[0.98] transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-3.5",children:[e.jsx("div",{className:"relative",children:s.avatar?e.jsx("img",{src:s.avatar,className:"w-12 h-12 rounded-full object-cover ring-2 ring-white dark:ring-slate-700",alt:s.name}):e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-sm font-bold bg-gradient-to-br from-indigo-100 to-purple-100 dark:from-indigo-900 dark:to-purple-900 text-indigo-600 dark:text-indigo-200 ring-2 ring-white dark:ring-slate-700",children:s.initials||s.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white text-[15px]",children:s.name}),e.jsxs("p",{className:"text-slate-400 text-[11px] font-medium mt-0.5 mb-1.5",children:[s.role," ",s.company?`@ ${s.company}`:""]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.tags.map(l=>e.jsx("span",{className:"px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400 rounded-md text-[9px] font-bold border border-slate-50 dark:border-slate-600",children:l},l))})]})]}),e.jsx("button",{className:"w-10 h-10 rounded-2xl bg-[#f1f5f9] dark:bg-slate-700/50 flex items-center justify-center text-slate-400",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"20px"},children:s.actionIcon||"chevron_right"})})]},s.id))})]},t))})]});return e.jsxs("div",{className:"flex flex-col h-full bg-[#f8fafc] dark:bg-slate-950 pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 bg-white dark:bg-slate-900 sticky top-0 z-30 border-b border-slate-50 dark:border-slate-800",children:[e.jsx("button",{className:"text-slate-800 dark:text-white",children:e.jsx("span",{className:"material-symbols-outlined",children:"menu"})}),e.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-white",children:x===n.HISTORY?"活動紀錄":"聯絡人清單"}),e.jsx("button",{onClick:()=>c(n.CONTACT_DETAIL),className:"text-primary",children:e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"28px",fontVariationSettings:"'FILL' 1"},children:"add_circle"})})]}),e.jsx("div",{className:"flex flex-col overflow-y-auto no-scrollbar",children:x===n.HISTORY?T():I()}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 max-w-[480px] mx-auto bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-t border-slate-100 dark:border-slate-800 flex justify-around py-2.5 px-4 z-40",children:[e.jsxs("button",{onClick:()=>c(n.DASHBOARD),className:`flex flex-col items-center gap-1 min-w-[64px] ${x===n.DASHBOARD?"text-primary":"text-slate-400"}`,children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontVariationSettings:x===n.DASHBOARD?"'FILL' 1":"",fontSize:"26px"},children:"contacts"}),e.jsx("span",{className:"text-[11px] font-bold",children:"聯絡人"})]}),e.jsxs("button",{onClick:()=>c(n.CHAT),className:"flex flex-col items-center gap-1 min-w-[64px] text-slate-400",children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"26px"},children:"smart_toy"}),e.jsx("span",{className:"text-[11px] font-medium",children:"助理"})]}),e.jsxs("button",{onClick:()=>c(n.HISTORY),className:`flex flex-col items-center gap-1 min-w-[64px] ${x===n.HISTORY?"text-primary":"text-slate-400"}`,children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontVariationSettings:x===n.HISTORY?"'FILL' 1":"",fontSize:"26px"},children:"history"}),e.jsx("span",{className:"text-[11px] font-bold",children:"History"})]}),e.jsxs("button",{onClick:g,className:"flex flex-col items-center gap-1 min-w-[64px] text-slate-400",children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"26px"},children:"login"}),e.jsx("span",{className:"text-[11px] font-medium",children:"登入"})]})]})]})};export{V as default};
